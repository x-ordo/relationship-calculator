# 유저 플로우 정의서

> Relationship ROI Calculator v1.0

---

## 목차

1. [핵심 플로우](#1-핵심-플로우)
   - [온보딩](#11-온보딩-플로우)
   - [기록 → 분석 → 공유](#12-핵심-사용-플로우)
   - [결제](#13-결제-플로우)
   - [Coach](#14-coach-사용-플로우)
2. [상태 전이](#2-상태-전이-다이어그램)
3. [조건부 분기점](#3-조건부-분기점)
4. [파일 맵핑](#4-핵심-파일-맵핑)
5. [업그레이드 방안](#5-업그레이드-방안-to-be)

---

## 1. 핵심 플로우

### 1.1 온보딩 플로우

신규 유저가 앱을 처음 사용할 때 거치는 5단계 설정 과정.

```
┌─────────────────────────────────────────────────────────────┐
│                       앱 시작                                │
│                          ↓                                   │
│              needsOnboarding() 체크                          │
│                    ↙     ↘                                   │
│               true        false                              │
│                ↓            ↓                                │
│         모달 표시      대시보드 진입                          │
└─────────────────────────────────────────────────────────────┘

┌─ Step 0: 소개 ──────────────────────────────────────────────┐
│  • 3가지 규칙 안내                                           │
│    - 손해면 손해라고 말한다 (감정 배제)                       │
│    - 브라우저 로컬 저장만 (서버 전송 없음)                    │
│    - 공유 시 익명화 + 체크리스트                             │
│                          ↓                                   │
│                    [시작하기]                                │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ Step 1: 시급 설정 (필수) ──────────────────────────────────┐
│  • 프리셋: 최저시급(9,860원) ~ 전문가(100,000원)             │
│  • 커스텀 입력 가능                                          │
│  • 시간 가치 예시 표시 (30분/1시간/2시간)                    │
│                          ↓                                   │
│               조건: hourlyRate > 0                           │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ Step 2: 사람 등록 (필수 2명) ──────────────────────────────┐
│  • 닉네임/이니셜 권장 (실명 금지)                            │
│  • "빠른 시작" 버튼: A/B 자동 생성                           │
│  • 클라이언트(B2B) 태그 가능                                 │
│                          ↓                                   │
│             조건: people.length >= 2                         │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ Step 3: 기록 입력 (필수 2개) ──────────────────────────────┐
│  • 직접 입력 또는 샘플 데이터 사용                           │
│  • 샘플: "경계 침해 + 후회" vs "상호 이득"                   │
│                          ↓                                   │
│             조건: entries.length >= 2                        │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ Step 4: 미리보기 & 완료 ───────────────────────────────────┐
│  • 리포트 생성 + 공유 카드 미리보기                          │
│  • 손실액, 최악의 사람, 원인 1위 표시                        │
│  • 다음 액션 제안: 공유 탭, 코치 탭                          │
│                          ↓                                   │
│                    [완료하기]                                │
│    → onboardingCompleted = true, onboardingVersion = 1       │
└──────────────────────────────────────────────────────────────┘

※ 스킵 경로: 언제든 [스킵] 버튼 → completeOnboarding() 호출 가능
```

**관련 이벤트**:
- `SETTINGS_PATCH { hourlyRateWon }`
- `PERSON_ADD { person }`
- `ENTRY_ADD { entry }`
- `SETTINGS_PATCH { onboardingCompleted, onboardingVersion }`

---

### 1.2 핵심 사용 플로우

일상적인 기록 입력 → 분석 확인 → 공유 과정.

```
┌─────────────────────────────────────────────────────────────┐
│                    대시보드 진입                             │
│                          ↓                                   │
│              people.length 체크                              │
│                    ↙     ↘                                   │
│                 = 0       > 0                                │
│                  ↓         ↓                                 │
│            EMPTY UI   HAS_PEOPLE UI                          │
│          (시작 유도)  (전체 기능)                            │
└─────────────────────────────────────────────────────────────┘

┌─ 기록 입력 ─────────────────────────────────────────────────┐
│                                                              │
│  ┌─ QuickLogBar ────────────────────────────────────────┐   │
│  │  사람 선택 (가로 스크롤)                              │   │
│  │  → selectedPersonId 설정                              │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  ┌─ QuickLogSheet / Card ───────────────────────────────┐   │
│  │  • 날짜 (기본: 오늘)                                  │   │
│  │  • 시간 (분): 0 ~ 1440                                │   │
│  │  • 금액 (원): 0 ~ 100,000,000                         │   │
│  │  • 감정 변화: -2 ~ +2                                 │   │
│  │  • 상호성: 1 ~ 5                                      │   │
│  │  • 경계 침해: checkbox                                │   │
│  │  • 메모: 자유 입력 (PII 스캔)                         │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│                    [저장] 클릭                               │
│                          ↓                                   │
│              validateEntry() 검증                            │
│                    ↙     ↘                                   │
│               실패        성공                               │
│                ↓          ↓                                  │
│           에러 표시   ENTRY_ADD 디스패치                     │
│                          ↓                                   │
│              domain.entries 업데이트                         │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ 분석 (자동) ───────────────────────────────────────────────┐
│                                                              │
│  buildReport(domain) 실행                                    │
│                          ↓                                   │
│  ┌─ Report 객체 생성 ───────────────────────────────────┐   │
│  │  • totals: { netLossWon, roiPct, costWon, benefitWon } │   │
│  │  • people: PersonAggregate[] (손해순 정렬)            │   │
│  │  • topCauseLabel: 손해 원인 1위                       │   │
│  │  • topPersonLabel: 최악의 사람                        │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  대시보드 UI 즉시 반영                                       │
│  • Hero 카드: 총 손실, ROI%                                  │
│  • 주간 요약: WeeklySummaryCard                              │
│  • 사람별 테이블: 손해순                                     │
│  • 최근 기록 목록                                            │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ 공유 (선택) ───────────────────────────────────────────────┐
│                                                              │
│              Share 탭으로 이동                               │
│                          ↓                                   │
│              shareSafetyIntroSeen 체크                       │
│                    ↙     ↘                                   │
│               false       true                               │
│                 ↓           ↓                                │
│          안전 모달     바로 설정                             │
│                 ↓           ↓                                │
│              [확인] ←───────┘                                │
│                          ↓                                   │
│  ┌─ 카드 설정 ──────────────────────────────────────────┐   │
│  │  • 레이아웃: 35개 (기본/강렬/영수증)                  │   │
│  │  • 카피 톤: 냉정/회복/유머 (50개)                     │   │
│  │  • 익명화: ON/OFF                                     │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│              PII 스캔 (자동)                                 │
│              → safety.level: DANGER/WARN/OK                  │
│                          ↓                                   │
│                 [PNG 저장] 클릭                              │
│                          ↓                                   │
│  ┌─ 체크리스트 모달 ────────────────────────────────────┐   │
│  │  • 필수 항목 6개 체크 필요                            │   │
│  │  • 권장 항목 (선택)                                   │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│              canProceed = true 확인                          │
│                          ↓                                   │
│              exportShareCardPng()                            │
│              → 다운로드 또는 Web Share API                   │
└──────────────────────────────────────────────────────────────┘
```

**손실 계산 공식**:
```
Cost = moneyWon
     + (minutes / 60) × hourlyRateWon
     + (boundaryHit ? 15,000 : 0)
     + (moodDelta < 0 ? |moodDelta| × 12,000 : 0)
     + (reciprocity ≤ 2 ? (3 - reciprocity) × 7,000 : 0)

Benefit = (moodDelta > 0 ? moodDelta × 10,000 : 0)
        + (reciprocity ≥ 4 ? (reciprocity - 3) × 6,000 : 0)

NetLoss = Cost - Benefit
ROI% = ((Benefit - Cost) / Cost) × 100
```

---

### 1.3 결제 플로우

FREE에서 PRO로 전환하는 결제 과정.

```
┌─────────────────────────────────────────────────────────────┐
│                    PRO 탭 진입                               │
│                          ↓                                   │
│                 domain.plan 체크                             │
│                    ↙     ↘                                   │
│               'free'      'paid'                             │
│                  ↓           ↓                               │
│            결제 UI      관리 UI                              │
│                          (토큰, 만료일)                      │
└─────────────────────────────────────────────────────────────┘

┌─ 경로 A: 직결제 (PortOne V2) ───────────────────────────────┐
│                                                              │
│  ┌─ 상품 선택 ──────────────────────────────────────────┐   │
│  │  • pro_monthly: ₩9,900 (30일)                         │   │
│  │  • pro_yearly: ₩99,000 (365일) [BEST]                 │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│                    [구매] 클릭                               │
│                          ↓                                   │
│              PAYMENT_START 디스패치                          │
│              paymentPhase: 'sdk_loading'                     │
│              UI: "결제 준비 중..."                           │
│                          ↓                                   │
│              PortOne SDK 동적 로드                           │
│                          ↓                                   │
│              paymentPhase: 'payment_pending'                 │
│              PortOne.requestPayment() 호출                   │
│                          ↓                                   │
│              사용자 결제 진행 (팝업/리다이렉트)              │
│                    ↙     ↘                                   │
│               취소        완료                               │
│                ↓           ↓                                 │
│  PAYMENT_FAIL    paymentPhase: 'verifying'                   │
│  "결제 취소됨"   UI: "결제 확인 중..."                       │
│                          ↓                                   │
│              POST /api/billing/verify                        │
│              { paymentId, token }                            │
│                    ↙     ↘                                   │
│               실패        성공                               │
│                ↓           ↓                                 │
│  PAYMENT_FAIL    PAYMENT_OK { token, expiresAt }             │
│                          ↓                                   │
│              domain.plan = 'paid'                            │
│              domain.entitlement = { token, expiresAt }       │
└──────────────────────────────────────────────────────────────┘

┌─ 경로 B: 언락 코드 (프로모션) ──────────────────────────────┐
│                                                              │
│  ┌─ 코드 입력 ──────────────────────────────────────────┐   │
│  │  placeholder: "PRO-XXXX-XXXX"                         │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│                    [언락] 클릭                               │
│                          ↓                                   │
│              PRO_UNLOCK_START 디스패치                       │
│                          ↓                                   │
│              POST /api/billing/unlock { code }               │
│                    ↙     ↘                                   │
│               실패        성공                               │
│                ↓           ↓                                 │
│  PRO_UNLOCK_FAIL   PRO_UNLOCK_OK { token }                   │
│  에러 메시지         ↓                                       │
│              TOKEN_SET 디스패치                              │
│                          ↓                                   │
│              domain.plan = 'paid'                            │
│              domain.entitlement.token = token                │
└──────────────────────────────────────────────────────────────┘

┌─ 모바일 콜백 (리다이렉트) ──────────────────────────────────┐
│                                                              │
│  PortOne 외부 결제 → redirectUrl 리다이렉트                  │
│  URL: /pro?payment=callback&paymentId=xxx                    │
│                          ↓                                   │
│  App 초기화 시 handlePaymentCallback() 실행                  │
│                          ↓                                   │
│  paymentId 파라미터 추출                                     │
│                          ↓                                   │
│  POST /api/billing/verify { paymentId }                      │
│                          ↓                                   │
│  결과 처리 (위와 동일)                                       │
│                          ↓                                   │
│  URL 정리: history.replaceState()                            │
└──────────────────────────────────────────────────────────────┘
```

**결제 단계 (PaymentPhase)**:
| 단계 | UI 표시 | 설명 |
|------|---------|------|
| `idle` | - | 대기 상태 |
| `sdk_loading` | "결제 준비 중..." | SDK 로드 |
| `payment_pending` | "결제창 열림" | 사용자 입력 대기 |
| `verifying` | "결제 확인 중..." | 서버 검증 |

---

### 1.4 Coach 사용 플로우

AI 판사에게 관계 판결을 요청하는 과정.

```
┌─────────────────────────────────────────────────────────────┐
│                    Coach 탭 진입                             │
│                          ↓                                   │
│  ┌─ 현재 상태 표시 ─────────────────────────────────────┐   │
│  │  모드: FREE(규칙) / PRO(서버 AI)                      │   │
│  │  이번 달 ROI: -45% · 순손실: -₩1,234,567             │   │
│  │  원인 1위: 경계 침해                                  │   │
│  └───────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ 입력 수집 ─────────────────────────────────────────────────┐
│                                                              │
│  ┌─ 심판 대상 (Context) ────────────────────────────────┐   │
│  │  [개인 관계 (B2C)]  [클라이언트 (B2B)]               │   │
│  │  → COACH_DRAFT { context }                            │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  ┌─ 판결 톤 (Tone) ─────────────────────────────────────┐   │
│  │  [냉정]  [정중]  [유머]                               │   │
│  │  → COACH_DRAFT { tone }                               │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  ┌─ 상황 진술 (Situation) ──────────────────────────────┐   │
│  │  textarea (max 500자)                                 │   │
│  │  예: "매번 일방적으로 부탁만 하는데..."               │   │
│  │  → COACH_DRAFT { situation }                          │   │
│  │                                                       │   │
│  │  ※ 실시간 글자수 표시: "123 / 500"                   │   │
│  │  ※ 초과 시 빨간색 + 버튼 비활성화                    │   │
│  └───────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ 실행 조건 검증 ────────────────────────────────────────────┐
│                                                              │
│  canRun = !isOverLimit                                       │
│         && situation.trim().length > 0                       │
│         && run.status !== 'loading'                          │
│                    ↙     ↘                                   │
│               false       true                               │
│                 ↓           ↓                                │
│           버튼 disabled   버튼 활성화                        │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ [판결 요청] 클릭 ──────────────────────────────────────────┐
│                          ↓                                   │
│              domain.plan 체크                                │
│                    ↙     ↘                                   │
│               'free'      'paid'                             │
│                  ↓           ↓                               │
│           FREE 경로     PAID 경로                            │
└──────────────────────────────────────────────────────────────┘

┌─ FREE 경로 ─────────────────────────────────────────────────┐
│                                                              │
│  COACH_RUN_START 디스패치                                    │
│                          ↓                                   │
│  fakeCoach({ report, situation, tone, context })             │
│  • 로컬 규칙 기반 판결                                       │
│  • 네트워크 요청 없음                                        │
│  • 즉시 응답                                                 │
│                          ↓                                   │
│  COACH_RUN_OK { data: CoachResult }                          │
└──────────────────────────────────────────────────────────────┘

┌─ PAID 경로 ─────────────────────────────────────────────────┐
│                                                              │
│  ┌─ Rate Limit 체크 ────────────────────────────────────┐   │
│  │  1분당 5회 제한                                       │   │
│  │  남은 요청: 3/5 (1분당)                               │   │
│  │                    ↙     ↘                            │   │
│  │             초과         통과                         │   │
│  │              ↓            ↓                           │   │
│  │  COACH_RUN_FAIL   계속 진행                           │   │
│  │  "N초 후 재시도"                                      │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  ┌─ 토큰 확인 ──────────────────────────────────────────┐   │
│  │                    ↙     ↘                            │   │
│  │             없음         있음                         │   │
│  │              ↓            ↓                           │   │
│  │  COACH_NEED_PRO   계속 진행                           │   │
│  │  + COACH_RUN_FAIL                                     │   │
│  │  "PRO 토큰 필요"                                      │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  COACH_RUN_START 디스패치                                    │
│  COACH_RATE_LIMIT_ADD (요청 타임스탬프 기록)                 │
│                          ↓                                   │
│  ┌─ API 호출 ───────────────────────────────────────────┐   │
│  │  POST /api/ai/coach                                   │   │
│  │  {                                                    │   │
│  │    report: Report,                                    │   │
│  │    situation: maskPii(situation),  // PII 마스킹      │   │
│  │    tone: Tone,                                        │   │
│  │    context: Context                                   │   │
│  │  }                                                    │   │
│  │  Authorization: Bearer {token}                        │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│              응답 처리                                       │
│                    ↙   ↓   ↘                                │
│               2xx    4xx    5xx                              │
│                ↓      ↓      ↓                               │
│  COACH_RUN_OK  에러 표시  Fallback                           │
│                       ↓                                      │
│              fakeCoach() + disclaimer                        │
│              "(서버 일시 장애로..."                          │
└──────────────────────────────────────────────────────────────┘
                          ↓
┌─ 결과 렌더링 ───────────────────────────────────────────────┐
│                                                              │
│  ┌─ CoachResult ────────────────────────────────────────┐   │
│  │  title: "관계 청산 권고안"                            │   │
│  │  grade: GUILTY | WARNING | PROBATION | INNOCENT       │   │
│  │         (유죄)   (경고)    (집행유예)   (무죄)        │   │
│  │  verdict: "주문 (선고문)"                             │   │
│  │  reasoning: "판결 이유"                               │   │
│  │  sentences: [{ label, text }]  // 복사용 문구         │   │
│  │  actions: string[]  // 이행 조항                      │   │
│  │  disclaimer?: string  // 고지문                       │   │
│  └───────────────────────────────────────────────────────┘   │
│                          ↓                                   │
│  ┌─ UI 표시 ────────────────────────────────────────────┐   │
│  │  • 헤더: "관계 감사 법원"                             │   │
│  │  • 등급 배지 (색상별)                                 │   │
│  │  • 주문 + 이유                                        │   │
│  │  • 선고 문구 카드 (클릭 → 복사)                       │   │
│  │  • 이행 조항 리스트                                   │   │
│  │  • 고지문                                             │   │
│  └───────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘
```

**등급 색상**:
| 등급 | 의미 | 색상 |
|------|------|------|
| `GUILTY` | 유죄 (즉시 손절) | 빨강 |
| `WARNING` | 경고 (비중 축소) | 노랑 |
| `PROBATION` | 집행유예 (관찰) | 파랑 |
| `INNOCENT` | 무죄 (유지) | 초록 |

---

## 2. 상태 전이 다이어그램

### 2.1 앱 로드 상태 (AppLoad)

```
┌────────┐     initApp()     ┌─────────┐
│  BOOT  │ ─────────────────→│ LOADING │
└────────┘                   └────┬────┘
                                  │
                    ┌─────────────┼─────────────┐
                    ↓             ↓             ↓
              ┌─────────┐   ┌─────────┐   ┌───────────┐
              │  READY  │   │RECOVERED│   │  (에러)   │
              └─────────┘   └─────────┘   └───────────┘
                  ↑              ↑
                  │              └── 스토리지 손상 시
                  │                  DEFAULT_STATE 복구
                  └── localStorage 로드 성공
```

### 2.2 비동기 작업 상태 (AsyncState)

```
              시작
                │
                ↓
┌────────┐  ────────────→  ┌─────────┐
│  idle  │                 │ loading │
└────────┘  ←────────────  └────┬────┘
    ↑                           │
    │         ┌─────────────────┼─────────────────┐
    │         ↓                 ↓                 ↓
    │   ┌─────────┐       ┌─────────┐       (재시도)
    │   │ success │       │  error  │
    │   │ { data }│       │ { msg } │
    │   └─────────┘       └─────────┘
    │         │                 │
    └─────────┴─────────────────┘
              (리셋)
```

**적용 대상**:
- `coachUi.run` - 코치 판결
- `proUi.unlock` - 언락 코드
- `proUi.payment` - 결제
- `shareUi.exportPng` - 이미지 내보내기
- `shareUi.webShare` - 공유

### 2.3 결제 단계 (PaymentPhase)

```
┌────────┐
│  idle  │←─────────────────────────────────────────────────┐
└───┬────┘                                                  │
    │ PAYMENT_START                                         │
    ↓                                                       │
┌─────────────┐                                             │
│ sdk_loading │ "결제 준비 중..."                           │
└──────┬──────┘                                             │
       │ SDK 로드 완료                                       │
       ↓                                                     │
┌─────────────────┐                                          │
│ payment_pending │ "결제창 열림"                            │
└────────┬────────┘                                          │
         │                                                   │
    ┌────┴────┐                                              │
    ↓         ↓                                              │
  취소      완료                                             │
    │         ↓                                              │
    │   ┌───────────┐                                        │
    │   │ verifying │ "결제 확인 중..."                      │
    │   └─────┬─────┘                                        │
    │         │                                              │
    │    ┌────┴────┐                                         │
    │    ↓         ↓                                         │
    │  실패      성공                                        │
    │    │         │                                         │
    └────┴─────────┴─────────────────────────────────────────┘
              PAYMENT_FAIL / PAYMENT_OK
```

---

## 3. 조건부 분기점

| 분기점 | 조건 | 경로 A | 경로 B |
|--------|------|--------|--------|
| **온보딩** | `needsOnboarding()` | 모달 표시 (5단계) | 스킵 → 대시보드 |
| **대시보드** | `people.length` | `= 0`: EMPTY UI | `> 0`: HAS_PEOPLE UI |
| **코치** | `plan` | `'free'`: 로컬 규칙 | `'paid'`: API 호출 |
| **코치 PRO** | `token` 존재 | 없음: NEED_PRO 경고 | 있음: 계속 |
| **코치 PRO** | Rate limit | 초과: 에러 | 통과: 계속 |
| **코치 PRO** | API 응답 | 5xx: Fallback | 2xx: 결과 표시 |
| **공유** | 첫 방문 | `true`: 안전 모달 | `false`: 바로 설정 |
| **공유** | PII 스캔 | `DANGER`: 경고 표시 | `OK`: 안전 표시 |
| **공유** | 체크리스트 | 미완료: 버튼 disabled | 완료: 저장 가능 |
| **결제** | 플랫폼 | 모바일: 리다이렉트 | 데스크탑: 팝업 |
| **결제** | 결과 | 취소/실패: 에러 | 성공: plan=paid |

---

## 4. 핵심 파일 맵핑

| 플로우 | 주요 파일 | 설명 |
|--------|----------|------|
| **온보딩** | `src/components/onboarding/OnboardingOverlay.tsx` | 5단계 모달 UI |
| **기록 입력** | `src/components/dashboard/DashboardPage.tsx` | 메인 대시보드 |
| | `src/components/dashboard/QuickLogBar.tsx` | 사람 선택 바 |
| | `src/components/dashboard/QuickLogSheet.tsx` | 입력 시트 |
| | `src/components/dashboard/QuickLogFab.tsx` | FAB 버튼 |
| **분석** | `src/shared/domain/report.ts` | buildReport() |
| **공유** | `src/components/share/SharePage.tsx` | 공유 설정 UI |
| | `src/shared/privacy/shareSafety.ts` | PII 스캔 |
| | `src/shared/utils/exportShareCard.ts` | PNG 내보내기 |
| **결제** | `src/components/pro/ProPage.tsx` | PRO 탭 UI |
| | `src/shared/payment/portone.ts` | PortOne SDK 래퍼 |
| **코치** | `src/components/coach/CoachPage.tsx` | 코치 UI |
| | `src/shared/rules/fakeCoach.ts` | 로컬 규칙 판결 |
| | `src/shared/api/coachApi.ts` | API 호출 |
| | `src/shared/privacy/pii.ts` | PII 마스킹 |
| **상태 관리** | `src/state/state.ts` | AppState 정의 |
| | `src/state/events.ts` | 이벤트 타입 |
| | `src/state/reducer.ts` | 리듀서 |
| | `src/state/actions.ts` | 액션 함수 |
| | `src/state/ui.ts` | UI 상태 타입 |
| **저장** | `src/shared/storage/state.ts` | localStorage |

---

## 5. 업그레이드 방안 (To-Be)

### 5.1 온보딩 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 5단계 선형 플로우 | 3단계로 축소 (시급+사람을 한 화면에) | P1 |
| 스킵 시 데이터 없음 | 스킵해도 샘플 데이터 자동 로드 | P1 |
| 완료 후 대시보드만 | 완료 후 "다음 할 일" 안내 (코치/공유) | P2 |
| 텍스트 위주 설명 | 애니메이션 튜토리얼 | P3 |

### 5.2 기록 입력 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 수동 입력만 | 음성 입력 지원 (Web Speech API) | P2 |
| 개별 항목 입력 | 프리셋 템플릿 (예: "경계 침해", "상호 이득") | P1 |
| 즉시 저장 | 입력 전 확인 모달 (실수 방지) | P2 |
| 삭제만 가능 | 수정 기능 추가 | P1 |

### 5.3 분석 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 월별 필터만 | 사람별/원인별 필터 추가 | P1 |
| 숫자 위주 | 트렌드 차트 (주간/월간 비교) | P1 |
| 정적 리포트 | 인사이트 알림 (예: "이번 주 경계 침해 3회") | P2 |
| 단일 뷰 | 사람별 상세 페이지 | P2 |

### 5.4 공유 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| PNG만 지원 | 링크 공유 (단축 URL + OG 이미지) | P2 |
| 수동 익명화 | AI 자동 익명화 제안 | P3 |
| 체크리스트 8개 | 필수 3개로 축소 + 나머지 자동 체크 | P1 |
| 단일 카드만 | 시리즈 카드 (여러 장 연속) | P3 |

### 5.5 결제 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 월/연만 지원 | 7일 무료 체험 추가 | P1 |
| 기능 제한 없음 | FREE 사용자 Coach 1일 3회 제한 | P1 |
| 만료 알림 없음 | D-7, D-1 푸시/이메일 알림 | P2 |
| 단일 결제 수단 | 카카오페이/네이버페이 추가 | P2 |

### 5.6 Coach 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 1회성 판결 | 대화형 후속 질문 | P2 |
| 텍스트만 | 음성 TTS 판결 읽기 | P3 |
| 복사만 | 카카오톡/인스타 직접 공유 | P2 |
| 상황만 입력 | 사람/기록 연동 판결 | P1 |

### 5.7 전체 UX 개선

| 현재 (As-Is) | 개선 (To-Be) | 우선순위 |
|--------------|--------------|----------|
| 탭 네비게이션만 | 바텀 네비 + 제스처 | P2 |
| 라이트 모드 없음 | 다크/라이트 모드 전환 | P2 |
| 데이터 내보내기 없음 | JSON/CSV 백업/복원 | P1 |
| 알림 없음 | 주간 리포트 푸시 알림 | P3 |

---

## 부록: 용어 정리

| 용어 | 설명 |
|------|------|
| `Entry` | 개별 기록 (시간/돈/감정/상호성/경계) |
| `Person` | 기록 대상 (닉네임, 클라이언트 여부) |
| `Report` | 분석 결과 (손실액, ROI, 원인 등) |
| `CoachResult` | 판결 결과 (등급, 주문, 이유 등) |
| `AsyncState` | 비동기 상태 (idle/loading/success/error) |
| `PaymentPhase` | 결제 단계 (sdk_loading/payment_pending/verifying) |
| `PII` | 개인 식별 정보 (전화번호, 이메일 등) |
| `Rate Limit` | 요청 제한 (PRO: 5회/분) |

---

*Last updated: 2024-12*
